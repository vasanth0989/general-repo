task generateSbom {
    description = 'Generates CycloneDX SBOM from resolved runtime dependencies'
    group = 'verification'

    doLast {
        def components = configurations.runtimeClasspath.resolvedConfiguration
            .resolvedArtifacts
            .collect { artifact ->
                def id = artifact.moduleVersion.id
                [
                    type     : "library",
                    group    : id.group,
                    name     : id.name,
                    version  : id.version,
                    purl     : "pkg:maven/${id.group}/${id.name}@${id.version}",
                    "bom-ref": "${id.group}:${id.name}:${id.version}"
                ]
            }

        def sbom = [
            bomFormat    : "CycloneDX",
            specVersion  : "1.4",
            serialNumber : "urn:uuid:${UUID.randomUUID()}",
            version      : 1,
            components   : components
        ]

        def bomFile = new File("${buildDir}/tmp/application.cdx.json")
        bomFile.parentFile.mkdirs()
        bomFile.text = groovy.json.JsonOutput.prettyPrint(
            groovy.json.JsonOutput.toJson(sbom)
        )

        println "SBOM generated at ${bomFile.path} with ${components.size()} components"
    }
}

// Generate SBOM before bootJar packages everything
bootJar.dependsOn generateSbom

// Embed the SBOM at the root of the fat jar
bootJar {
    from("${buildDir}/tmp/application.cdx.json") {
        into("/")
    }
}
```

## Why this is the perfect solution
```
build/
  libs/
    app-1.0.jar          ← fat jar (unchanged, published as-is)
      └── application.cdx.json  ← SBOM embedded at root
      └── BOOT-INF/lib/
          └── kafka-avro-serializer-7.9.0.jar
          └── ... all other deps
  tmp/
    application.cdx.json ← intermediate file, not published
