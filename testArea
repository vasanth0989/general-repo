tasks.register("cleanupNexusIqSbom") {
    group = "build"
    description = "Deletes SBOM from build/libs before publish so only the boot jar remains."

    doLast {
        def libsDir = file("$buildDir/libs")
        if (!libsDir.exists()) return

        // delete any SBOM files you might generate
        def patterns = [
                ~/.*-bom\.json$/,
                ~/.*-bom\.xml$/,
                ~/.*\.cdx\.json$/,
                ~/.*\.cdx\.xml$/
        ]

        libsDir.listFiles()?.each { f ->
            if (patterns.any { p -> f.name ==~ p }) {
                println "Deleting SBOM file before publish: ${f.name}"
                f.delete()
            }
        }
    }
}


tasks.matching { it.name.toLowerCase().startsWith("publish") }.configureEach {
    dependsOn("cleanupNexusIqSbom")
}
